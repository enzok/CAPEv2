{% extends "base.html" %}
{% block content %}
<div class="archive-files">
    <div class="card">
    {% if paging.show_file_next == "show" or paging.show_file_prev == "show" %}
        <nav aria-label="Page navigation">
           <ul class="pagination justify-content-center">
           {% if paging.show_file_prev == "show" %}
               <li class="page-item"><a class="page-link" href="{% url "analysis" %}archive/page/{{paging.prev_page}}/">&larr; Newer</a></li>
           {% endif %}
           {% if paging.files_page_range %}
               {% for page in paging.files_page_range %}
                   {% if page == paging.current_page %}
                   <li class="page-item active"><a class="page-link">{{page}}</a></li>
                   {% else %}
                   <li class="page-item"><a class="page-link" href="{% url "analysis" %}archive/page/{{page}}/">{{page}}</a></li>
                   {% endif %}
               {% endfor %}
           {% endif %}
           {% if paging.show_file_next == "show" %}
               <li class="page-item"><a class="page-link" href="{% url "analysis" %}archive/page/{{paging.next_page}}/">Older &rarr;</a></li>
           {% endif %}
           </ul>
        </nav>
    {% endif %}
        <div class="card ">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center"><h6>Archive Files</h6>
                    <form class="form-inline" style="margin:0px;" action="{% url "archive_search" %}" enctype="multipart/form-data" method="post">{% csrf_token %}
                        <input class="form-control mr-1" type="text" id="form_archive_search" name="archive_search" placeholder="Search term as regex">
                        <button class="btn btn-dark" type="submit">Search Archive</button>
                    </form>
                </div>
            </div>
            {% if files %}
            <table class="table table-striped table-sm" style="table-layout: fixed;">
                <thead>
                <tr>
                    <th width="5%">ID</th>
                    <th width="10%">Timestamp</th>
                    <th width="8%">Package</th>
                    <th width="25%">Filename</th>
                    <th width="28%">MD5</th>
                    <th width="20%">Detections</th>
                    {% if config.virustotal %}
                    <th width="6%">VT</th>
                    {% endif %}
                </tr>
                </thead>
                <tbody>
                {% for analysis in files %}
                    <tr>
                        <td>
                        <a href="{% url "archive_report" analysis.info.id %}"><span class="mono">{{analysis.info.id}}</span></a>
                        </td>
                        <td>
                        {{analysis.info.started}}
                        </td>
                        <td>
                        <span class="mono">{{analysis.info.package}}</span>
                        </td>
                        <td>
                        {{analysis.target.file.name}}
                        </td>
                        <td>
                        <a href="{% url "archive_report" analysis.info.id %}"><span class="mono">{{analysis.target.file.md5}}</span></a>
                        </td>
                        <td>
                        {% if analysis.detections %}
                            {{analysis.detections}}
                        {% else %}
                            -
                        {% endif %}
                        </td>
                        <td>
                        {% if analysis.virustotal_summary %}
                            <span class="mono">{{analysis.virustotal_summary}}</span></a>
                        {% else %}
                            <span class="mono">-</span>
                        {% endif %}
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="card-body">No files to display on this page.</div>
            {% endif %}
        </div>
        {% if paging.show_file_next == "show" or paging.show_file_prev == "show" %}
        <nav aria-label="Page navigation">
           <ul class="pagination justify-content-center">
           {% if paging.show_file_prev == "show" %}
               <li class="page-item" ><a class="page-link" href="{% url "analysis" %}archive/page/{{paging.prev_page}}/">&larr; Newer</a></li>
           {% endif %}
           {% if paging.files_page_range %}
               {% for page in paging.files_page_range %}
                   {% if page == paging.current_page %}
                   <li class="page-item active"><a class="page-link">{{page}}</a></li>
                   {% else %}
                   <li class="page-item"><a class="page-link" href="{% url "analysis" %}archive/page/{{page}}/">{{page}}</a></li>
                   {% endif %}
               {% endfor %}
           {% endif %}
           {% if paging.show_file_next == "show" %}
               <li class="page-item"><a class="page-link" href="{% url "analysis" %}archive/page/{{paging.next_page}}/">Older &rarr;</a></li>
           {% endif %}
           </ul>
        </nav>
    {% endif %}
    </div>
</div>

{% endblock %}
